# 语法分析

语法分析器（parser）从词法分析器输出的token序列中识别出各类短语，并构造语法分析树（parse tree）

语法分析树：

描述了句子的语法结构

算法分为自顶向下和自底向上算法，其中，递归下降算法是一种常见的自顶向下算法。

递归下降算法（Recursive Descent Parsing）

上下文无关文法（Context-free Grammar，CFG）

左递归、优先级和结合性等问题

上级文法嵌套下级文法，上级的算法调用下级的算法。表现在生成 AST 中，上级算法生成上级节点，下级算法生成下级节点。这就是“下降”的含义。

程序结构基本上是跟文法规则同构的。这就是递归下降算法的优点，非常直观。

形式文法被严格地定义为四元组G=（N，T，P，S），

S：start 开始符号
P：productions 生成式集合
T：terminal 终结符集合
N：Nonterminal 非终结符集合

重点研究的四类文法：

根据P中生成式a→β的特点，可以将形式文法及其产生的形式语言分类，构成所谓的形式语言谱系。形式语言理论中重点研究四类文法和语言：

0型文法。又称为无限制文法。这种文法对生成式a→β不作特殊限制，a和β可以是任意的文法符号串，当然a不能是空字符串。0型文法是形式语言谱系中最大的文法类。由0型文法产生的形式语言恰是图灵机所识别的语言类，即递归可枚举语言。

1型文法。又称为上下文有关文法。这种文法要求生成式a→β满足|a|≤|β|，即β要至少和a一样长。由1型文法产生的语言称为1型语言或上下文有关语言。1型语言恰是非确定型线性有界自动机所识别的语言类。

2型文法。又称为上下文无关文法。这种文法要求生成式a→β中的a必须是变元。由2型文法产生的语言称为2型语言或上下文无关语言。2型语言恰是由下推自动机所识别的语言类。

3型文法。又称为正则文法。这种文法分为两种类型：第一类要求生成式的形式必须是A→ωB或A→ω，其中A，B都是变元，ω是终结符串（可以是空串），这种特殊的正则文法称为右线性文法。第二类正则文法称为左线性文法，它要求生成式必须是A→Bω，或A→ω的形式。由正则文法生成的语言称为正则语言，它恰是有穷自动机所识别的语言类。

上述定义的4种语言类具有依次包含关系，即对于i=0，1，2，在不考虑空字符串时，i型语言都真包含i+1型语言。

左递归是递归下降算法无法处理的，这是递归下降算法最大的问题。

文法规则中，对于左结合的运算符，递归项要放在左边；而右结合的运算符，递归项放在右边。

左递归问题是我们用递归下降算法写语法分析器遇到的最大的一只“拦路虎”。

“巴科斯范式”，简称 BNF

```bnf
add ::= mul | add + mul
mul ::= pri | mul * pri
pri ::= Id | Num | (add)
```

扩展巴科斯范式 (EBNF)。它跟普通的 BNF 表达式最大的区别，就是里面会用到类似正则表达式的一些写法。

```ebnf
add -> mul (+ mul)*
```

- 优先级是通过在语法推导中的层次来决定的，优先级越低的，越先尝试推导。
- 结合性是跟左递归还是右递归有关的，左递归导致左结合，右递归导致右结合。
- 左递归可以通过改写语法规则来避免，而改写后的语法又可以表达成简洁的 EBNF 格式，从而启发我们用循环代替右递归。
